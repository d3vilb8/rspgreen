import{W as F,r as u,j as e}from"./app-OWEBvdtC.js";import{H as A,N as H}from"./Nav-CmIRCLvo.js";import{C as f}from"./choices.min-qgg1WXJ1.js";import{N as L}from"./notyf.min-DLu_xjpT.js";import"./iconBase-hI8KM4xB.js";import"./index-CGRCqaVb.js";import"./index-BSTxKt_a.js";const i=new L,M=({employees:h,projects:d,taskcategory:P,user:y,user_type:_,notif:g,tls:v})=>{const{data:l,setData:n,post:N,errors:p}=F({task_name:"",estimate_hours:"",sdate:"",edate:"",leader_id:[],employee_id:[],employee_hours:{},status:"",priority:0,project_id:d.length>0?d[0].id:""}),j=u.useRef(null),x=u.useRef(null);u.useEffect(()=>{const s=new f(j.current,{removeItemButton:!0,searchEnabled:!0}),r=new f(x.current,{removeItemButton:!0,searchEnabled:!0});return()=>{s.destroy(),r.destroy()}},[]);const o=s=>{const{name:r,value:t}=s.target;n(a=>({...a,[r]:t}))},b=s=>{const r=Array.from(s.target.selectedOptions,t=>t.value);n("employee_id",r),n(t=>{const a={...t.employee_hours};return r.forEach(c=>{a[c]||(a[c]="")}),{...t,employee_hours:a}})},w=s=>{const r=Array.from(s.target.selectedOptions,t=>t.value);n("leader_id",r)},E=(s,r)=>{n(t=>({...t,employee_hours:{...t.employee_hours,[s]:r}}))},C=async s=>{s.preventDefault();const r=parseInt(l.project_id);if(!d.find(a=>a.id===r)){i.error("Selected project not found.");return}parseFloat(l.estimate_hours),N("/task-store",{data:l,onSuccess:()=>{i.success("Task created successfully with notification sent.")},onError:a=>{typeof a=="object"&&a!==null?Object.entries(a).forEach(([c,m])=>{Array.isArray(m)?m.forEach(S=>i.error(S)):i.error(m)}):i.error("An unexpected error occurred.")}})},k=l.task_name.replace(/\u00A0/g," ").trim();return e.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[e.jsx(A,{user:y,notif:g}),e.jsx(H,{user_type:_}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx("div",{className:"flex items-center justify-between"})}),e.jsx("div",{className:"p-3 table-section",children:e.jsxs("form",{onSubmit:C,className:"px-[8rem] grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task_name",children:"Project Name"}),e.jsx("input",{type:"text",name:"task_name",className:"w-full rounded-lg",value:l.task_name,onChange:o}),p.name&&e.jsx("div",{children:p.name})]}),e.jsx("div",{children:k!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Hours"}),e.jsx("input",{className:"w-full rounded-lg",id:"estimate_hours",name:"estimate_hours",type:"number",value:l.estimate_hours,onChange:o})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Team Leader"}),e.jsxs("select",{ref:j,multiple:!0,name:"leader_id",id:"leader_id",value:l.leader_id,onChange:w,className:"w-full rounded-lg",children:[e.jsx("option",{value:"",children:"Select Employee"}),v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Employee Assign"}),e.jsxs("select",{ref:x,multiple:!0,name:"employee_id",id:"employee_id",value:l.employee_id,onChange:b,className:"w-full rounded-lg",children:[e.jsx("option",{value:"",children:"Select Employee"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),l.employee_id.length>0&&e.jsx("div",{className:"col-span-2",children:l.employee_id.map(s=>{var r;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`employee_hours_${s}`,children:["Hours for"," ",(r=h.find(t=>t.id===parseInt(s)))==null?void 0:r.name," ",":"]}),e.jsx("input",{className:"w-full rounded-lg",type:"number",id:`employee_hours_${s}`,name:`employee_hours_${s}`,value:l.employee_hours[s]||"",onChange:t=>E(s,t.target.value)})]},s)})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sdate",children:"Start Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"sdate",name:"sdate",type:"date",value:l.sdate,onChange:o,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edate",children:"End Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"edate",name:"edate",type:"date",value:l.edate,onChange:o,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Priority"}),e.jsxs("select",{id:"",className:"w-full rounded-lg",name:"priority",value:l.priority,onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Priority --"}),e.jsx("option",{value:"0",children:"Low"}),e.jsx("option",{value:"1",children:"Medium"}),e.jsx("option",{value:"2",children:"High"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Create"})})]})})]})};export{M as default};
