import{r as a,W as M,j as e}from"./app-DecQ0f_S.js";import{F as E,c as S}from"./index-c1-G4gL8.js";import{C as $}from"./choices.min-DQfvTG_5.js";import{N as B}from"./notyf.min-DLu_xjpT.js";import"./iconBase-DWhxbjqT.js";const i=new B,R=({assin:N,emp:y})=>{const[u,h]=a.useState(!1),[c,x]=a.useState(!1),[n,p]=a.useState(null),[v,k]=a.useState("");a.useState(!1);const f=a.useRef(null),{data:o,setData:d,post:C,errors:g}=M({estimateHours:0,employee_id:[]});a.useEffect(()=>{if(!u&&!c)return;const s=new $(f.current,{removeItemButton:!0,searchEnabled:!0});return o.employee_id.length>0&&o.employee_id.forEach(t=>{s.setChoiceByValue(t)}),f.current.addEventListener("change",t=>{const l=Array.from(t.target.selectedOptions).map(b=>b.value);d("employee_id",l)}),()=>{s.destroy()}},[u,c,o.employee_id,d]);const A=s=>{if(!s){console.error("Task is null or undefined");return}p(s),p({...s,estimate_time:s.estimate_time||0}),d("estimateHours",s.estimate_hours||0),h(!0)},H=s=>{if(!s){console.error("Task is null or undefined");return}p(s),d("employee_id",s.users.map(t=>t.id)||[]),x(!0)},L=s=>{d("estimateHours",s.target.value)},w=s=>{if(s.preventDefault(),!(n!=null&&n.id)){i.error("No valid task ID available"),console.error("No valid task ID available");return}let t=null;for(let r of N)if(r.tasks.some(m=>m.id===n.id)){t=r;break}if(!t){i.error("Project not found"),console.error("Project not found");return}const l=t.tasks.reduce((r,m)=>r+m.estimate_time,0);if(l>t.estimate_time){i.error(`Total task estimate hours (${l} hours) exceed the project estimate hours (${t.estimate_time} hours).`);return}const b=c?`/updateEstimateemp/${n.id}`:`/updateEstimateHours/${n.id}`;C(b,{onSuccess:()=>{i.success("Task updated successfully"),h(!1),x(!1)},onError:r=>{typeof r=="object"&&r!==null?Object.entries(r).forEach(([m,j])=>{Array.isArray(j)?j.forEach(T=>i.error(T)):i.error(j)}):i.error("An unexpected error occurred."),console.error("Server-side validation errors:",r)}})},_=N.filter(s=>s.title.toLowerCase().includes(v.toLowerCase()));return e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"text",placeholder:"Search projects...",value:v,onChange:s=>k(s.target.value),className:"w-[40%] mt-5 p-2 border rounded-md"}),e.jsx("div",{className:`modal fixed top-0 left-0 w-full h-full transition-all duration-500 bg-black/50 flex justify-center items-center ${u?"opacity-100 visible pointer-events-auto":"opacity-0 invisible pointer-events-none"}`,children:e.jsxs("div",{className:"w-2/5 p-4 px-6 bg-white rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Update Task"}),e.jsx("button",{onClick:()=>h(!1),children:e.jsx(E,{})})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("form",{className:"py-3 space-y-5",onSubmit:w,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estimate Hours:"}),e.jsx("input",{type:"number",value:o.estimateHours,onChange:L,className:"w-full p-2 border rounded-md",placeholder:"Enter estimate hours",required:!0}),g.estimateHours&&e.jsx("p",{className:"text-sm text-red-500",children:g.estimateHours})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"submit",className:"px-8 py-2 text-sm font-semibold text-white bg-blue-500 rounded-md",children:"Submit"})})]})]})}),e.jsx("div",{className:`modal fixed top-0 left-0 w-full h-full transition-all duration-500 bg-black/50 flex justify-center items-center ${c?"opacity-100 visible pointer-events-auto":"opacity-0 invisible pointer-events-none"}`,children:e.jsxs("div",{className:"w-2/5 p-4 px-6 bg-white rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Assign Employees"}),e.jsx("button",{onClick:()=>x(!1),children:e.jsx(E,{})})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("form",{className:"py-3 space-y-5",onSubmit:w,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Assign Employees:"}),e.jsx("select",{ref:f,multiple:!0,value:o.employee_id,className:"w-full p-2 border rounded-md",required:!0,children:y.length>0?y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id)):e.jsx("option",{value:"",disabled:!0,children:"No employees available"})})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"submit",className:"px-8 py-2 text-sm font-semibold text-white bg-blue-500 rounded-md",children:"Submit"})})]})]})}),_.length>0?_.map(s=>e.jsxs("div",{className:"mt-5 text-center border heading",children:[s.error_message&&e.jsx("div",{className:"p-2 text-red-500 error-message",children:s.error_message}),e.jsx("div",{className:"bg-[#01214F] p-2 text-white",children:e.jsxs("h1",{className:"capitalize",children:["Project name: ",s.title," ",s.estimate_time," hours"]})}),e.jsx("div",{className:"grid grid-cols-4",children:s.tasks.length>0?s.tasks.map(t=>e.jsxs("div",{className:"border border-t-0",children:[e.jsxs("div",{className:"bg-[#0C94CA] p-2 text-white text-[0.9rem] flex justify-between",children:[e.jsxs("h1",{className:"text-center",children:[t.task_name," ",t.task_name!=="NON-BILLABLE"?`${t.estimate_hours} hours`:""]}),t.task_name.trim()!=="NON-BILLABLE"&&e.jsx("button",{className:"ml-2 text-white",onClick:()=>A(t),children:e.jsx(S,{})})]}),e.jsx("div",{className:"employee",children:e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-1 text-left border-b-2",children:"Members"}),e.jsx("th",{className:"border-b-2",children:e.jsx("button",{className:"ml-2 text-black",onClick:()=>H(t),children:e.jsx(S,{})})})]})}),e.jsx("tbody",{children:t.users.length>0?t.users.map(l=>e.jsxs("tr",{className:"p-2 border",children:[e.jsx("td",{className:"p-3 text-left",children:l.name}),e.jsxs("td",{children:[l.time_number_sum," hours"]})]},l.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"2",className:"p-2 text-center",children:"No members assigned"})})})]})})]},t.id)):e.jsx("p",{className:"p-4 text-center",children:"No tasks available"})})]},s.id)):e.jsx("p",{className:"p-4 text-center",children:"No projects available"})]})};export{R as default};
