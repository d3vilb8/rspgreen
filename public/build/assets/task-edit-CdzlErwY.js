import{r as o,W as N,j as e}from"./app-OWEBvdtC.js";import{H as w,N as S}from"./Nav-CmIRCLvo.js";import{N as C}from"./notyf.min-DLu_xjpT.js";import{M as k}from"./index-Dd66xK6T.js";import{C as F}from"./choices.min-qgg1WXJ1.js";import"./iconBase-hI8KM4xB.js";import"./index-CGRCqaVb.js";import"./index-BSTxKt_a.js";const h=new C,P=({project:i,employees:m,user:p,user_type:x,notif:_,tls:v})=>{const[u,L]=o.useState(i.assignments.map(t=>t.employee_id)||[]),[n,j]=o.useState(i.assignments.reduce((t,s)=>(t[s.employee_id]=s.employee_hours||"",t),{})),[a,T]=o.useState({}),{data:r,setData:d,post:y}=N({task_name:i.task_name||"",estimate_hours:i.estimate_hours||"",estimate_budget:i.estimate_budget||"",sdate:i.sdate||"",edate:i.edate||"",leader_id:i.team.map(t=>t.user_id)||[],employee_id:u||[],employee_hours:n||{},priority:i.priority||0}),g=t=>{t.preventDefault();const s=Object.values(n).reduce((l,E)=>l+parseFloat(E||0),0);if(s>parseFloat(r.estimate_hours)){h.error(`Total employee hours (${s} hours) exceed the task estimate of ${r.estimate_hours} hours.`);return}y(`/task-update/${i.id}`,{onSuccess:()=>{h.success("Task updated successfully")}})},f=(t,s)=>{const l={...n,[t]:s};j(l),d("employee_hours",l)},c=o.useRef(null);o.useEffect(()=>{const t=new F(c.current,{removeItemButton:!0,searchEnabled:!0});return()=>{t.destroy()}},[]);const b=t=>{const s=Array.from(t.target.selectedOptions,l=>l.value);d("leader_id",s)};return e.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[e.jsx(w,{user:p,notif:_}),e.jsx(S,{user_type:x}),e.jsxs("form",{onSubmit:g,className:"px-[8rem] grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",children:"Title:"}),e.jsx("input",{className:"w-full rounded-lg",type:"text",id:"title",value:r.task_name,onChange:t=>d("task_name",t.target.value)}),a.task_name&&e.jsx("div",{children:a.task_name})]}),i.task_name!=="NON-BILLABLE"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Time:"}),e.jsx("input",{className:"w-full rounded-lg",type:"text",id:"estimate_hours",value:r.estimate_hours,onChange:t=>d("estimate_hours",t.target.value)}),a.estimate_hours&&e.jsx("div",{children:a.estimate_hours})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_date",children:"Start Date:"}),e.jsx("input",{className:"w-full rounded-lg",type:"date",id:"sdate",value:r.sdate,onChange:t=>d("sdate",t.target.value)}),a.sdate&&e.jsx("div",{children:a.sdate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_date",children:"End Date:"}),e.jsx("input",{className:"w-full rounded-lg",type:"date",id:"edate",value:r.edate,onChange:t=>d("edate",t.target.value)}),a.edate&&e.jsx("div",{children:a.edate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Team Leader"}),e.jsxs("select",{ref:c,multiple:!0,name:"leader_id",id:"leader_id",value:r.leader_id,onChange:b,className:"w-full rounded-lg",children:[e.jsx("option",{value:"",children:"Select Employee"}),v.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employees",children:"Assign Employees:"}),e.jsx(k,{options:m,selectedValues:m.filter(t=>u.includes(t.id)),onSelect:(t,s)=>{d("employee_id",[...r.employee_id,s.id])},onRemove:(t,s)=>{d("employee_id",r.employee_id.filter(l=>l!==s.id))},displayValue:"name",className:"w-full rounded-lg"}),a.employee_id&&e.jsx("div",{children:a.employee_id})]}),r.employee_id.map(t=>{var s;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`estimate_time_${t}`,children:["Estimate Time for"," ",(s=m.find(l=>l.id===t))==null?void 0:s.name,":"]}),e.jsx("input",{type:"text",id:`employee_hours_${t}`,value:n[t]||"",onChange:l=>f(t,l.target.value),className:"w-full rounded-lg"}),a[`employee_hours_${t}`]&&e.jsx("div",{children:a[`employee_hours_${t}`]})]},t)}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Priority"}),e.jsxs("select",{id:"",className:"w-full rounded-lg",name:"priority",value:r.priority,onChange:t=>d("priority",t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Priority --"}),e.jsx("option",{value:"0",children:"Low"}),e.jsx("option",{value:"1",children:"Medium"}),e.jsx("option",{value:"2",children:"High"})]})]}),e.jsx("br",{}),e.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Save"})]})]})};export{P as default};
