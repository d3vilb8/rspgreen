import{r as x,W as R,j as e}from"./app-OWEBvdtC.js";import{F as E}from"./index-CGRCqaVb.js";import{N as I}from"./notyf.min-DLu_xjpT.js";import{M as A}from"./index-Dd66xK6T.js";import{H as D,N as q}from"./Nav-CmIRCLvo.js";import"./iconBase-hI8KM4xB.js";import"./index-BSTxKt_a.js";const b=new I;function O({customers:j,products:N,taxes:g,invoiceNumber:y}){const[i,u]=x.useState([{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}]),[W,w]=x.useState(0),[m,_]=x.useState(""),T=()=>{u([...i,{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}])},S=l=>{const s=i.filter((t,n)=>n!==l);u(s)},p=(l,s,t)=>{const n=i.map((o,h)=>{if(h===l){const d={...o,[s]:s==="product"?t:Number(t)};return(s==="quantity"||s==="price")&&(d.amount=d.quantity*d.price),d}return o});u(n),v(n)},f=(l,s)=>{const t=i.map((n,o)=>o===l?{...n,selectedTaxes:s}:n);u(t),v(t)},v=l=>{const s=l.map(n=>{const o=n.selectedTaxes.reduce((h,d)=>h+n.amount*(d.percent/100),0);return n.amountWithTax=n.amount+o,n}),t=s.reduce((n,o)=>n+(o.amountWithTax-o.amount),0);w(t),u(s)},{post:C,data:c,setData:r,errors:a,processing:P}=R({bill_no:y,status:"",date:"",customer_id:"",mobile_no:"",amc_type:"",email:"",discount:"",billing_address:"",sales_details:[],invoice_type:""});x.useEffect(()=>{r(l=>({...l,sales_details:i||[],invoice_type:m}))},[i,m]);const F=l=>{l.preventDefault(),C(route("sales.store"),{onSuccess:()=>{b.success("Sales added successfully!")},onError:()=>{b.error("Failed to add sales. Please check your inputs.")}})};return e.jsxs("div",{className:"w-[83.2%] ml-[11.5rem] absolute right-0 overflow-hidden",children:[e.jsx(D,{}),e.jsx(q,{}),e.jsxs("div",{className:"px-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Add Invoice"}),e.jsxs("form",{onSubmit:F,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"invoiceType",children:"Invoice Type"}),e.jsxs("select",{name:"invoiceType",value:m,onChange:l=>_(l.target.value),className:"w-full rounded form-select",children:[e.jsx("option",{value:"",children:"-- Select Invoice Type --"}),e.jsx("option",{value:"tax",children:"Tax Invoice"}),e.jsx("option",{value:"pi",children:"PI Invoice"}),e.jsx("option",{value:"cash",children:"Cash Invoice"})]}),a.invoice_type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.invoice_type})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:" Invoice Number."}),e.jsx("input",{disabled:!0,onChange:l=>r("bill_no",l.target.value),value:c.bill_no,type:"text",className:"w-full rounded form-input",placeholder:"Enter bill no"}),a.bill_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.bill_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:l=>r("status",l.target.value),value:c.status,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"full_paid",children:"Full Paid"}),e.jsx("option",{value:"half_paid",children:"Half Paid"})]}),a.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.status})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Invoice Date "}),e.jsx("input",{type:"date",name:"date",onChange:l=>r("date",l.target.value),value:c.date,className:"w-full rounded form-input",placeholder:"Enter bill no"}),a.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.date})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Customer Name"}),e.jsxs("select",{name:"",onChange:l=>r("customer_id",l.target.value),value:c.customer_id,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Customer --"}),j&&j.map((l,s)=>e.jsx("option",{value:l.user_id,children:l.name},s))]}),a.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.customer_id})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Mobile No"}),e.jsx("input",{type:"tel",onChange:l=>r("mobile_no",l.target.value),value:c.mobile_no,className:"w-full rounded form-input",placeholder:"Enter mobile no"}),a.mobile_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.mobile_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:l=>r("email",l.target.value),value:c.email,className:"w-full rounded form-input",placeholder:"Enter email"}),a.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.email})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Discount"}),e.jsx("input",{type:"number",onChange:l=>r("discount",l.target.value),value:c.discount,className:"w-full rounded form-input",placeholder:"Enter discount"}),a.discount&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.discount})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:l=>r("billing_address",l.target.value),value:c.billing_address,id:"",rows:2,className:"w-full rounded resize-none form-textarea"}),a.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.billing_address})]}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Sales Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border border-gray-300",children:"Service"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Quantity"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Price (Af)"}),m==="tax"&&e.jsx("th",{className:"p-2 border border-gray-300",children:"Tax"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Amount (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Action"})]})}),e.jsx("tbody",{children:i.map((l,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"w-full rounded form-select",value:l.product,onChange:t=>p(s,"product",t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Service --"}),N.map((t,n)=>e.jsx("option",{value:t.name,children:t.name},n))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.quantity,onChange:t=>p(s,"quantity",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.price,onChange:t=>p(s,"price",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx(A,{options:g.map(t=>({name:`${t.name} (${t.percent}%)`,percent:t.percent})),selectedValues:l.selectedTaxes,onSelect:t=>f(s,t),onRemove:t=>f(s,t),displayValue:"name"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.amountWithTax.toFixed(2),readOnly:!0})}),e.jsx("td",{className:"p-2",children:s!==0&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm font-medium text-red-500",onClick:()=>S(s),children:[e.jsx(E,{size:15}),e.jsx("span",{children:"Delete"})]})})]},s))})]}),e.jsx("button",{type:"button",className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded",onClick:T,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"px-6 py-2 text-sm font-medium text-white rounded bg-rose-600",children:"Add Sale"})})]})]})]})}export{O as default};
