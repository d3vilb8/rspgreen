import{r as o,W as O,j as e}from"./app-DecQ0f_S.js";import $ from"./sidebar-Be9qf3jp.js";import{H,N as U}from"./Nav-BWBa_EZw.js";import{M as g}from"./Modal-BhgbF3q9.js";import{N as q}from"./notyf.min-DLu_xjpT.js";import"./iconBase-DWhxbjqT.js";import"./index-BPKSu1J7.js";import"./index-c1-G4gL8.js";import"./transition-CWN7uk3v.js";const Z=({user:w,notif:_,user_type:u,branchesa:d,searchEmpCount:R,employees:v})=>{const[C,p]=o.useState(!1),[B,x]=o.useState(!1),[i,b]=o.useState(null),[W,T]=o.useState(null),[z,f]=o.useState([]);console.log("kjhgf",u);const t=new q,{data:s,setData:c,post:k,reset:j,errors:F}=O({b_name:"",transfer_to:""});o.useEffect(()=>{y()},[]);const y=async()=>{try{const r=await axios.get("/branches");f(r.data)}catch(r){console.error("Error fetching branches:",r)}},N=(r=null)=>{p(!0),c("b_name",r?r.b_name:""),b(r?r.id:null)},m=()=>{p(!1),b(null),j("b_name")},E=r=>{x(!0),c("current_branch",r),console.log("Branch ID:",r)},h=()=>{x(!1),j("transfer_to")},S=r=>{r.preventDefault();const l=s.selectedBranchId?`/branches-update/${i}`:"/branches";k(l,{onSuccess:()=>{t.success(i?"Branch updated successfully!":"Branch created successfully!"),y(),m()},onError:()=>{t.error("An error occurred while saving the branch.")}})},M=async r=>{var l,a;if(r.preventDefault(),s.current_branch===s.transfer_to){t.error("Employee is already in this branch.");return}console.log("Transfer Data:",{current_branch:s.current_branch,transfer_to:s.transfer_to,employee_id:s.employee_id});try{const n=await axios.post(`/branches-transfer/${s.current_branch}`,{transfer_to:s.transfer_to,employee_id:s.employee_id});n.data.success&&(t.success(n.data.success),h(),T(A=>A.filter(I=>I.id!==s.employee_id)),window.location.reload())}catch(n){(a=(l=n.response)==null?void 0:l.data)!=null&&a.error?t.error(n.response.data.error):t.error("An error occurred while transferring the employee."),console.error(n)}},D=async(r,l)=>{if(l){t.error("This branch has employees, so deletion is not allowed.");return}else if(confirm("Are you sure you want to delete this branch?"))try{console.log("Attempting to delete branch with ID:",r),await axios.delete(`/branches/${r}`),t.success("Branch deleted successfully!"),window.location.reload(),f(a=>Array.isArray(a)?a.filter(n=>n.id!==r):[])}catch(a){console.error("Error deleting branch:",a),a.response&&a.response.status===404?t.error("Branch not found. Deletion failed."):t.error("An error occurred while deleting the branch.")}};return e.jsxs("div",{className:"w-[85.2%] absolute right-0",children:[e.jsx(H,{user:w,notif:_}),e.jsx(U,{user_type:u}),e.jsxs("div",{className:"flex px-9",children:[e.jsx($,{}),e.jsxs("div",{className:"flex-1 p-6 bg-gray-100",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Manage Branch"}),e.jsx("button",{onClick:()=>N(),className:"p-2 text-teal-900 underline rounded-md",children:"Create Branch"})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("table",{className:"min-w-full border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left border-b",children:"Branch Name"}),e.jsx("th",{className:"px-4 py-2 text-left border-b",children:"Total Employees"}),e.jsx("th",{className:"px-4 py-2 text-right border-b",children:"Action"})]})}),e.jsx("tbody",{children:d.map(r=>e.jsxs("tr",{className:"transition duration-200 hover:bg-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-b",children:r.name}),e.jsx("td",{className:"px-4 py-2 text-center border-b",children:r.empCount}),e.jsxs("td",{className:"px-4 py-2 text-right border-b",children:[e.jsx("button",{onClick:()=>N(r),className:"text-blue-600 underline hover:text-blue-800",children:"Edit"}),r.empCount!==0&&e.jsx("button",{onClick:()=>E(r.id),className:"ml-4 text-green-600 underline hover:text-green-800",children:"Transfer"}),e.jsx("button",{onClick:()=>D(r.id,r.empCount>0),className:"ml-4 text-red-600 underline hover:text-red-800",children:"Delete"})]})]},r.id))})]})})]})]}),e.jsx(g,{show:C,onClose:m,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:i?"Edit Branch":"Create New Branch"}),e.jsxs("form",{onSubmit:S,className:"mt-4",children:[e.jsxs("label",{className:"block mb-2",children:["Branch Name:",e.jsx("input",{type:"text",value:s.b_name,onChange:r=>c("b_name",r.target.value),className:"block w-full p-2 mt-1 border border-gray-300 rounded-md",required:!0})]}),e.jsx("button",{type:"submit",className:"p-2 mt-4 text-white bg-blue-600 rounded-md",children:i?"Update Branch":"Create Branch"}),e.jsx("button",{onClick:m,type:"button",className:"p-2 mt-2 text-white bg-red-600 rounded-md",children:"Close"})]})]})}),e.jsx(g,{show:B,onClose:h,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Transfer Branch"}),e.jsxs("form",{onSubmit:M,className:"mt-4",children:[e.jsxs("label",{className:"block mb-2",children:["Transfer To:",e.jsxs("select",{value:s.transfer_to,onChange:r=>c("transfer_to",r.target.value),className:"block w-full p-2 mt-1 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a branch"}),d==null?void 0:d.filter(r=>r.id!==s.current_branch).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("label",{className:"block mb-2 mt-4",children:["Select Employee:",e.jsxs("select",{value:s.employee_id,onChange:r=>c("employee_id",r.target.value),className:"block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",disabled:!0,children:"Select an employee"}),v.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsx("button",{type:"submit",className:"p-2 mt-2 text-white bg-green-600 rounded-md",children:"Transfer"}),e.jsx("button",{onClick:h,type:"button",className:"p-2 mt-2 text-white bg-red-600 rounded-md",children:"Close"})]})]})})]})};export{Z as default};
