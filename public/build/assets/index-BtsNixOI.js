import{r as a,j as e,a as i,b as u}from"./app-DecQ0f_S.js";import{H,N as I,a as q}from"./Nav-BWBa_EZw.js";import{h as Q}from"./index-BPKSu1J7.js";import{F as U}from"./index-c1-G4gL8.js";import{R as X}from"./index-e435n7mr.js";import"./iconBase-DWhxbjqT.js";const G=o=>{const d={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString(void 0,d)},te=({leave:o,user:d,user_type:r,notif:y})=>{const[w,C]=a.useState([]),[l,L]=a.useState(""),[p,S]=a.useState([]),[j,f]=a.useState(1),[c]=a.useState(10),[k,D]=a.useState(!1),[b,E]=a.useState(null),[N,n]=a.useState(!1),[x,P]=a.useState("");a.useEffect(()=>{Array.isArray(r)?C(r):console.error("Expected user_type to be an array:",r)},[r]),a.useEffect(()=>{const t=o.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.type_name.toLowerCase().includes(l.toLowerCase())||s.reason.toLowerCase().includes(l.toLowerCase()));S(t)},[l,o]);const g=j*c,A=g-c,v=p.slice(A,g),R=Math.ceil(p.length/c),T=Array.from({length:R},(t,s)=>s+1),F=t=>{L(t.target.value),f(1)},$=async t=>{try{if(!x.trim()){alert("Please provide a reason for rejection");return}await u.post(`/leave-reject/${t}`,{reason:x}),alert("Leave rejected successfully"),n(!1),window.location.reload()}catch(s){console.error("There was an error rejecting the leave!",s)}},M=async t=>{try{await u.post(`/leave-approve/${t}`),alert("Leave approved successfully"),window.location.reload()}catch(s){console.error("There was an error approving the leave!",s)}},O=async(t,s)=>{if(t.preventDefault(),window.confirm("Are you sure you want to delete this leave?"))try{await u.get(`/leave-store-delete/${s}`),alert("Leave deleted successfully"),window.location.reload()}catch(m){console.error("There was an error deleting the leave!",m)}},_=(t,s)=>{const m=new Date(t),z=new Date(s),B=Math.abs(z-m);return Math.ceil(B/(1e3*60*60*24))+1},h=t=>{E(b===t?null:t)};return e.jsxs("div",{className:"w-[85.2%] px-8 absolute right-0 overflow-hidden",children:[e.jsx(H,{user:d,notif:y}),e.jsx(I,{user_type:r}),e.jsx("div",{className:`modal absolute top-0 left-0 w-full h-full transition-all duration-500 bg-black/50 flex justify-center items-center ${k?"opacity-100 visible pointer-events-auto":"opacity-0 invisible pointer-events-none"}`,children:e.jsxs("div",{className:"w-2/5 p-4 px-6 bg-white rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Modal header"}),e.jsx("button",{onClick:()=>D(!1),children:e.jsx(U,{})})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("form",{action:"#",className:"py-3 space-y-5",children:[e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"start-date",className:"text-sm font-medium",children:"Start Date"}),e.jsx("input",{id:"start-date",type:"date",className:"rounded form-input"})]}),e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"end-date",className:"text-sm font-medium",children:"End Date"}),e.jsx("input",{id:"end-date",type:"date",className:"rounded form-input"})]}),e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"number",className:"text-sm font-medium",children:"Number"}),e.jsx("input",{id:"number",type:"number",className:"rounded form-input"})]}),e.jsx("div",{children:e.jsx("button",{className:"px-8 py-2 text-sm font-semibold text-white bg-blue-500 rounded-md",children:"Submit"})})]})]})}),e.jsxs("div",{className:"px-8 table-section",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("input",{type:"text",value:l,onChange:F,placeholder:"Search employees...",className:"w-1/3 p-2 border rounded-md"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"grid p-2 mt-2 text-black rounded-lg place-items-center",children:e.jsx(i,{href:"leave-create",className:"underline",children:"Add New"})}),w.includes("view_leave_type")&&e.jsx("div",{className:"grid p-2 mt-2 text-black rounded-lg place-items-center",children:e.jsx(i,{href:"leave-type",children:"Leave Type"})})]})]}),e.jsx("br",{}),e.jsxs("table",{className:"table w-full p-4 border",children:[e.jsx("thead",{className:"border bg-[#0A1B3F] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left border",children:"Employee Name"}),e.jsx("th",{className:"p-3 text-left border",children:"Leave Type"}),e.jsx("th",{className:"p-3 text-left border",children:"Applied On"}),e.jsx("th",{className:"p-3 text-left border",children:"Start Date"}),e.jsx("th",{className:"p-3 text-left border",children:"End Date"}),e.jsx("th",{className:"p-3 text-left border",children:"Total Days"}),e.jsx("th",{className:"p-3 text-left border",children:"Leave Reason"}),e.jsx("th",{className:"p-3 text-left border",children:"Extra Leave"}),e.jsx("th",{className:"p-3 text-left border",children:"Status"}),e.jsx("th",{className:"p-3 text-left border",children:"Action"})]})}),e.jsx("tbody",{children:v.length>0?v.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 border",children:t.name}),e.jsx("td",{className:"p-3 border",children:t.type_name}),e.jsx("td",{className:"p-3 border",children:G(t.created_at)}),e.jsx("td",{className:"p-3 border",children:t.sdate}),e.jsx("td",{className:"p-3 border",children:t.edate}),e.jsx("td",{className:"p-3 border",children:_(t.sdate,t.edate)}),e.jsx("td",{className:"p-3 border",children:t.reason}),e.jsx("td",{className:"p-3 border",children:t.is_unpaid===1?e.jsx("p",{className:"text-[1rem] text-center",children:"Unpaid"}):e.jsx("p",{className:"text-[1rem] text-center",children:"Paid"})}),e.jsxs("td",{className:"p-3 border relative",onClick:()=>{N||h(t.id)},children:[d==="Admin"?e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:t.status===0?"px-2 py-1 m-1 text-blue-700 rounded transition-colors duration-300 ease-in-out":t.status===1?"px-2 py-1 m-1 text-red-700 rounded transition-colors duration-300 ease-in-out":t.status===2?"px-2 py-1 m-1 text-gray-700 rounded transition-colors duration-300 ease-in-out":"",onClick:s=>{s.stopPropagation(),h(t.id)},children:t.status===0?"Approve":t.status===1?"Reject":t.status===2?"Pending":""}),e.jsx("div",{className:`absolute left-0 top-0 h-[6rem] z-40 mt-9 bg-white rounded shadow-lg transition-all duration-300 ease-in-out overflow-hidden ${b===t.id?"max-h-screen opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{children:[e.jsx("p",{onClick:s=>{s.stopPropagation(),M(t.id)},className:"text-gray-800 p-2 hover:text-green-500 cursor-pointer",children:"Approve"}),e.jsx("hr",{}),e.jsx("p",{onClick:s=>{s.stopPropagation(),n(!0),h(null)},className:"text-gray-800 p-2 hover:text-red-500 cursor-pointer",children:"Reject"})]})})]}):t.status===0?e.jsx("span",{className:"text-blue-500",children:"Approve"}):t.status===1?e.jsx("span",{className:"text-red-700",children:"Reject"}):t.status===2?e.jsx("span",{className:"text-gray-900",children:"Pending"}):"",N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>n(!1),children:e.jsxs("div",{className:"bg-white p-5 rounded shadow-lg w-[90%] max-w-md relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700",onClick:()=>n(!1),children:"âœ•"}),e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Rejection Reason"}),e.jsx("textarea",{value:x,onChange:s=>P(s.target.value),placeholder:"Enter the reason for rejection...",className:"w-full p-2 border rounded mb-3",rows:4}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:()=>$(t.id),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Submit"})]})]})})]}),e.jsx("td",{className:"border",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{className:"text-white p-2 rounded text-[1.5rem] bg-blue-500",href:`leave/show/${t.id}`,children:e.jsx(q,{})}),e.jsx(i,{className:"bg-green-800 p-2 rounded text-white text-[1.5rem]",href:`leave-store-edit/${t.id}`,children:e.jsx(Q,{})}),e.jsx("button",{className:"bg-red-800 p-2 rounded text-white text-[1.5rem]",onClick:s=>O(s,t.id),children:e.jsx(X,{})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"py-4 text-center",children:"No results found"})})})]}),e.jsx("div",{className:"flex justify-between mt-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:T.map(t=>e.jsx("button",{onClick:()=>f(t),className:`px-4 py-2 rounded ${j===t?"bg-blue-500 text-white":"bg-gray-200"}`,children:t},t))})})]})]})};export{te as default};
